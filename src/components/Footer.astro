---
import { Icon } from "astro-icon/components";
import pkg from "../../package.json" with { type: "json" };
import { profileConfig, siteConfig } from "../config";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
const version = pkg.version;
---

<!-- 不蒜子访问量统计 -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--<div class="border-t border-[var(&#45;&#45;primary)] mx-16 border-dashed py-8 max-w-[var(&#45;&#45;page-width)] flex flex-col items-center justify-center px-6">-->
<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>

<!-- Runtime网站运行计时 -->
<script is:inline define:vars={{ 
	startDate: siteConfig.startDate,
	dayUnit: i18n(I18nKey.dayUnit), 
	hourUnit: i18n(I18nKey.hourUnit), 
	minuteUnit: i18n(I18nKey.minuteUnit), 
	secondUnit: i18n(I18nKey.secondUnit),
	dayUnitSingular: i18n(I18nKey.dayUnitSingular),
	hourUnitSingular: i18n(I18nKey.hourUnitSingular),
	minuteUnitSingular: i18n(I18nKey.minuteUnitSingular),
	secondUnitSingular: i18n(I18nKey.secondUnitSingular)
}}>
let uptimeInterval = null;
let uptimeElements = [];

function updateUptime() {
	const start = new Date(startDate);
	const now = new Date();
	const diff = Math.max(0, now.getTime() - start.getTime());

	const days = Math.floor(diff / 1000 / 60 / 60 / 24);
	const hours = Math.floor((diff / 1000 / 60 / 60) % 24);
	const minutes = Math.floor((diff / 1000 / 60) % 60);
	const seconds = Math.floor((diff / 1000) % 60);

	const dayText = days === 1 ? dayUnitSingular : dayUnit;
	const hourText = hours === 1 ? hourUnitSingular : hourUnit;
	const minuteText = minutes === 1 ? minuteUnitSingular : minuteUnit;
	const secondText = seconds === 1 ? secondUnitSingular : secondUnit;

	const uptimeStr = `${days}${dayText}${hours}${hourText}${minutes}${minuteText}${seconds}${secondText}`;
	uptimeElements.forEach(el => {
		el.textContent = uptimeStr;
	});
}

function startUptimeTimer() {
	if (uptimeInterval) clearInterval(uptimeInterval);
	uptimeElements = document.querySelectorAll('.uptime-display');
	updateUptime();
	uptimeInterval = setInterval(updateUptime, 1000);
}

if (document.readyState === 'loading') {
	document.addEventListener('DOMContentLoaded', startUptimeTimer);
} else {
	startUptimeTimer();
}

if (window.swup?.hooks) {
	window.swup.hooks.on('page:view', () => {
		if (uptimeInterval) clearInterval(uptimeInterval);
		startUptimeTimer();
	});
}

window.addEventListener('beforeunload', () => {
	if (uptimeInterval) {
		clearInterval(uptimeInterval);
		uptimeInterval = null;
	}
});
</script>
<!--<div class="transition bg-[oklch(92%_0.01_var(&#45;&#45;hue))] dark:bg-black rounded-2xl py-8 mt-4 mb-8 flex flex-col items-center justify-center px-6">-->
<div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6">
    <div class="transition text-50 text-sm text-center mb-2">
        {i18n(I18nKey.websiteRuntimeText)} <span class="uptime-display transition link text-[var(--primary)] font-medium">{i18n(I18nKey.loading)}</span>
    </div>
    <div class="transition text-50 text-sm text-center mb-2">
        <span id="busuanzi_container_site_pv" style="display:none">本站总访问量 <span id="busuanzi_value_site_pv" class="transition link text-[var(--primary)] font-medium"></span> 次</span>
    </div>
    <div class="transition text-50 text-sm text-center mb-2">
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name}. {i18n(I18nKey.allRightsReserved)}<br>
        {i18n(I18nKey.poweredBy)}
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/ChuwuYo/Charlotte">Charlotte ver {version}</a>
    </div>
    <nav class="flex flex-wrap gap-2 justify-center items-center text-50 text-sm" aria-label="Subscriptions">
        <a class="btn-regular-sm" target="_blank" href={url('rss.xml')} aria-label="RSS">
            <Icon name="material-symbols:rss-feed-rounded" class="inline-block align-middle" aria-hidden="true"/>
            <span class="inline-block align-middle">RSS</span>
        </a>
        <span class="inline-block align-middle" aria-hidden="true">|</span>
        <a class="btn-regular-sm" target="_blank" href={url('atom.xml')} aria-label="Atom">
            <Icon name="fa6-solid:atom" class="inline-block align-middle" aria-hidden="true"/>
            <span class="inline-block align-middle">Atom</span>
        </a>
        <span class="inline-block align-middle" aria-hidden="true">|</span>
        <a class="btn-regular-sm" target="_blank" href={url('sitemap-index.xml')} aria-label="Sitemap">
            <Icon name="material-symbols:map-rounded" class="inline-block align-middle" aria-hidden="true"/>
            <span class="inline-block align-middle">Sitemap</span>
        </a>
    </nav>
</div>