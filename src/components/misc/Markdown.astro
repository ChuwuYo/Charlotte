---
import "@fontsource-variable/jetbrains-mono";
import "@fontsource-variable/jetbrains-mono/wght-italic.css";

interface Props {
	class: string;
}
const className = Astro.props.class;
---
<div data-pagefind-body class={`prose dark:prose-invert prose-base !max-w-none custom-md ${className}`}>
    <!--<div class="prose dark:prose-invert max-w-none custom-md">-->
    <!--<div class="max-w-none custom-md">-->
    <slot/>
</div>

<script>
/**
 * Code Toolbar Copy Button Handler
 * 处理代码块工具栏中的复制按钮点击事件
 */
document.addEventListener("click", function (e: MouseEvent) {
    const target = e.target as Element | null;
    if (!target) return;
    
    // 查找复制按钮
    const copyBtn = target.closest(".code-toolbar-copy") as HTMLElement | null;
    if (!copyBtn) return;
    
    // 防止重复点击
    if (copyBtn.classList.contains("success")) return;
    
    // 查找对应的代码块
    const frame = copyBtn.closest(".frame");
    const preEle = frame?.querySelector("pre");
    const codeEle = preEle?.querySelector("code");
    
    if (!codeEle) return;
    
    // 提取代码内容（排除折叠区域的 summary）
    const code = Array.from(codeEle.querySelectorAll(".code:not(summary *)"))
        .map(el => el.textContent)
        .join("\n");
    
    // 检查代码是否为空
    if (!code || code.trim() === "") {
        console.warn("Code block is empty");
        return;
    }
    
    // 复制到剪贴板
    navigator.clipboard.writeText(code).then(() => {
        // 清除之前的 timeout
        const timeoutId = copyBtn.getAttribute("data-timeout-id");
        if (timeoutId) {
            clearTimeout(parseInt(timeoutId));
        }
        
        // 添加成功状态
        copyBtn.classList.add("success");
        
        // 设置新的 timeout 并保存 ID
        const newTimeoutId = setTimeout(() => {
            copyBtn.classList.remove("success");
        }, 1500);
        
        copyBtn.setAttribute("data-timeout-id", newTimeoutId.toString());
    }).catch(err => {
        console.error("Failed to copy code:", err);
    });
});
</script>
