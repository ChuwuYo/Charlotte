---
import { Icon } from "astro-icon/components";
import { url } from "../utils/url-utils";

interface DropdownItem {
    name: string;
    url: string;
    external?: boolean;
}

interface Props {
    title: string;
    items: DropdownItem[];
    class?: string;
}

const { title, items, class: className } = Astro.props;
---

<!-- 完全模仿 LightDarkSwitch 的结构和样式 -->
<div class={`relative z-50 ${className || ''}`} role="menu" tabindex="-1" onmouseleave={`hide${title}Panel()`}>
    <button 
        aria-label={`${title} Menu`} 
        role="menuitem" 
        class="relative btn-plain scale-animation rounded-lg h-11 font-bold px-5 active:scale-95 flex items-center gap-1" 
        id={`${title}-menu-switch`}
        onmouseenter={`show${title}Panel()`}
    >
        {title}
        <Icon name="material-symbols:keyboard-arrow-down-rounded" class="text-[1rem] transition-transform" />
    </button>

    <div 
        id={`${title}-menu-panel`} 
        class="hidden lg:block absolute transition float-panel-closed top-11 -right-2 pt-5"
    >
        <div class="card-base float-panel p-2">
            {items.map((item) => (
                <a 
                    href={item.external ? item.url : url(item.url)} 
                    target={item.external ? "_blank" : null}
                    class="flex transition whitespace-nowrap items-center !justify-start w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95 mb-0.5 last:mb-0"
                >
                    <span class="mr-3">{item.name}</span>
                    {item.external && (
                        <Icon name="fa6-solid:arrow-up-right-from-square" class="text-[0.875rem] transition -translate-y-[1px] ml-auto text-black/[0.2] dark:text-white/[0.2]" />
                    )}
                </a>
            ))}
        </div>
    </div>
</div>

<script define:vars={{ title }}>
function showDropdownPanel(menuTitle) {
    const panel = document.querySelector(`#${menuTitle}-menu-panel`);
    if (panel) {
        panel.classList.remove('float-panel-closed');
    }
}

function hideDropdownPanel(menuTitle) {
    const panel = document.querySelector(`#${menuTitle}-menu-panel`);
    if (panel) {
        panel.classList.add('float-panel-closed');
    }
}

// 为当前组件创建特定的函数
const currentTitle = title;
function showCurrentPanel() {
    showDropdownPanel(currentTitle);
}

function hideCurrentPanel() {
    hideDropdownPanel(currentTitle);
}

// 确保函数在全局可用
if (typeof window !== 'undefined') {
    window[`show${currentTitle}Panel`] = showCurrentPanel;
    window[`hide${currentTitle}Panel`] = hideCurrentPanel;
    
    // 通用函数也暴露到全局，供其他组件使用
    window.showDropdownPanel = showDropdownPanel;
    window.hideDropdownPanel = hideDropdownPanel;
}
</script>